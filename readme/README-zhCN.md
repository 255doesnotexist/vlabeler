
# vLabeler

[![Discord](https://img.shields.io/discord/984044285584359444?style=for-the-badge&label=discord&logo=discord&logoColor=ffffff&color=7389D8&labelColor=6A7EC2)](https://discord.gg/yrTqG2SrRd)

选择语言：[English](../README.md) | [简体中文](README-zhCN.md) | [日本語](README-ja.md)

`vLabeler` 是一个开源的语音标注应用程序，旨在提供：

- 现代，流畅的 UI/UX
- 可定制的标注流程，以供多个语音合成软件使用
- 高性能的多平台支持

**该项目现在处于 Alpha 阶段。
如需帮助、建议、问题报告等，请加入我们的 [Discord](https://discord.gg/yrTqG2SrRd)。**

## 下载

请参阅 [Releases](https://github.com/sdercolin/vlabeler/releases)。

Releases 中提供了适用于以下平台的应用程序包。

- Windows (.zip/.exe)
- Mac（Apple Silicon 或 Intel）（.dmg）
- Ubuntu (.deb)

对于其他类型的 Linux 操作系统，您可能需要自己进行构建。

## 构建

vLabeler 基于 [Compose Multiplatform](https://github.com/JetBrains/compose-jb) 开发。
您可以使用 Gradle 来构建应用。[查看更多](https://github.com/JetBrains/compose-jb/tree/master/tutorials/Native_distributions_and_local_execution)

目前不支持跨平台构建。您只能构建适用于您的操作系统的应用程序包。

请确保您有 **JDK 15+** 用于构建。

```
// 构建安装包
./gradlew package

// 或者，构建可执行程序
./gradlew createDistributable
```

## 使用场景

vLabeler 的许多行为都依赖于可定制的 `标注器`。

目前，vLabeler 提供了以下内建标注器：

#### 处理 UTAU 的原音设定文件

![](utau-singer.gif)

适用于 UTAU 原音设定的的内建标注器有以下两项：

- UTAU oto 标注器

  如果您只想编辑一个 `oto.ini` 文件，请使用此标注器。

- UTAU singer 标注器

  如果您想编辑一个歌手声库下的多个 oto.ini 文件，请使用此标注器。
  请在创建工程时将 `采样目录`设置为歌手的根文件夹（通常包含一个 `character.txt` 文件）。

#### 处理音频分割标注（连续编辑模式）

![](nnsvs-singer.gif)

对于 NNSVS/ENUNU 和类似语音合成系统中使用的标注文件，您可以使用以下选项：

- Sinsy lab 标注器

  此标注器适用于 Sinsy (NNSVS/ENUNU) 格式的 lab 文件，它使用 `100ns` 作为时间单位，使用 ` `（空格）作为分隔符。
  每个工程只接受一个标注文件。wav 文件通过文件名绑定到标注文件，例如，
  如果输入标注文件是 `foo.lab`，则将从 `采样目录` 中选择名为 `foo.wav` 的 wav 文件。

- Audacity 标注器

  此标注器适用于 Audacity 创建的 `Labels` 文件，它使用 `s` 作为时间单位，并使用 `\t` (tab) 作为分隔符。
  每个工程只接受一个标注文件。wav 文件通过文件名绑定到标注文件。 
  例如，如果输入标注文件是 `foo.txt`，则会从 `Sample Directory` 中选择名为 `foo.wav` 的 wav 文件。

- NNSVS singer 标注器

  此标注器与 `Sinsy lab 标注器` 基本相同，但可以处理多个标注文件。
  通常，如果您的文件结构如下：
  ```
  - singer
      - wav
        - 1.wav
        - 2.wav
      - lab
        - 1.lab
        - 2.lab
  ```
  您可以通过将 `采样目录` 设置为 `singer` 文件夹来创建包含所有 lab 文件的工程。
  您可以在标注器的设置中更改 `wav` 和 `lab` 文件夹名称。

## 基本使用流程

1. 点击 `新建工程...`
2. 选择 `采样目录` 为您的音频文件所在的文件夹
3. 您可以按需更改 `工程文件存放位置` 和 `工程名`
4. 如果您想将缓存文件（渲染图像、处理后的 wav 文件等）保存在别处，请更改 `缓存目录`
5. 选择一个标注器。请参阅 [使用场景](#使用场景) 来帮助您选择正确的标注器
6. 如果您还没有对应的标注文件，您可以选择一个模板生成器来生成标注文件的模版
7. 如果您想要编辑现有的标注文件，请选择输入文件及其编码
8. 检查您选择的标注器和模版生成器的设置
9. 点击 `确定`，开始编辑 
10. 点击菜单中的 `导出`，得到编辑后的标注文件

## 可用的键盘/鼠标操作

请注意，如果您使用的是 macOS，则以下的 `Ctrl` 指的是 `Command`。

您可以在 `设置` -> `偏好设置` -> `键位映射` 中更改快捷键设置。

### 移动参数线

- 鼠标拖动普通参数线：移动它自己
- 鼠标拖动主要参数线：同时移动所有参数线
- `Shift`：反转普通/主要。例如，按住 Shift 键的同时拖动主要参数线，只会移动它自身

### 音频播放

- `Space`：播放当前条目，如果已经在播放，则停止播放
- `Shift` + `Space`：播放当前采样文件，如果已经在播放，则停止播放
- 鼠标右键点击：播放点击的部分
- `Alt` + 鼠标拖动参数：移动的同时播放光标位置附近的音频

### 滚动

- `Shift` + 鼠标滚轮滚动：水平滚动
- `F` 或底部栏中央的焦点按钮：滚动以使当前条目在屏幕上居中

### 放大/缩小

- `=` 或底部栏中的 `+` 按钮：放大
- `=` 或底部栏中的 `-` 按钮：缩小
- `Ctrl` + `Shift` + 鼠标滚轮：放大/缩小
- 底部栏中的分辨率按钮：打开分辨率输入对话框

### 切换条目/采样

- 鼠标滚轮滚动：转到上一个/下一个条目
- `Up`/`Down`：转到上一个/下一个条目
- 底部栏中的 `<`/`>` 按钮：转到上一个/下一个条目
- `Ctrl` + 鼠标滚轮滚动：转到上一个/下一个采样
- `Ctrl` + `Up`/`Down`：转到上一个/下一个采样
- 底部栏中的 `<<`/`>>` 按钮：转到上一个/下一个采样
- `Ctrl` + `G` 或底部栏中的条目编号按钮：显示 `跳转到条目...` 对话框

### 设置条目备注

- `J` 或条目标题栏中的添加标签按钮：开始编辑条目的标签
- `K` 或点击条目标题栏中的星标按钮：切换条目的星标状态
- `L` 或点击条目标题栏中的完成按钮：切换条目的完成状态

#### 关于备注的设置

您可以在 `设置` -> `偏好设置` -> `编辑器` -> `备注` 中设置隐藏您不需要使用的备注内容。

当您编辑条目中的任何值时，默认情况下，该条目将自动被设为 `已完成` 状态。您可以在上述设置关闭这个功能。

## 多条目编辑模式

对于采用[连续模式](#处理音频分割标注（连续编辑模式）)的标注器，你可以在单条目编辑模式和多条目编辑模式间切换。
在多条目编辑模式下，同一采样文件中的互相连接的条目将会被全部显示在屏幕上。您不需切换条目就可以编辑它们。

连续模式的编辑器默认启用多条目编辑模式。您可以点击底部栏中央的 `单/多条目编辑` 按钮来切换。

在多条目编辑模式下，条目的名称会显示在编辑器顶端。您可以通过点击它们执行以下操作：

- 点击：重命名条目
- 长按：转到条目

## 浏览和筛选条目

有两个组件显示条目列表：

1. 固定条目列表：默认显示在编辑器右侧。您可以在菜单 `视图` -> `固定条目列表` 中显示或隐藏它。它提供了一个拥有完整功能的条目筛选器（下述）。
2. `跳转到条目...` 对话框：当您按下 `Ctrl` + `G` 或单击底部栏中的条目编号按钮时显示。 它提供了一个简单的条目筛选器。

### 高级搜索

在这两种类型的条目列表中，您都可以使用以下格式来搜索条目：

```
aaa;name:bbb;sample:ccc;tag:ddd
```

多个条件通过`;`组合。只有符合所有条件的条目才会被显示。

高级搜索支持以下条件名（`:` 的左边部分）：

- 无条件名：在条目名、采样名或标签中搜索
- `name`：在条目名中搜索
- `sample`：在采样名中搜索
- `tag`：在标签中搜索

这里的搜索的采用 `包含` 匹配。

### 扩展筛选器面板

在固定条目列表中，您可以单击 `展开` 按钮以显示更多选项。

对于 `完成` 筛选器和 `星标` 筛选器，单击按钮将依次按以下顺序切换：`不筛选`、`仅显示已星标/已完成` 和 `仅显示未星标/未完成` 之间切换。

这些筛选器与上述搜索词产生的筛选器以 `AND` 逻辑结合。

### 将筛选器链接到编辑器

默认情况下，工程导航（通过键盘快捷键、鼠标滚轮滚动或按钮单击转到下一个采样/条目等）不受筛选器影响。

例如，即使你已经筛选掉了条目列表中的条目 `no.5`，在显示条目 `4` 时，如果您按下 `Down` 键，仍然将转到条目 `5`。

扩展筛选器中的 `链接` 按钮可以帮助您专注于编辑一组特定的条目。当它被按下时，导航时将跳过固定条目列表中未显示的条目。

在上面的例子中，如果 `链接` 按钮处于按下状态，您将转到条目 `6` 而不是 条目 `5`。

请注意，`跳转到条目...` 对话框不受筛选器的影响，因此您可以通过它转到任何条目，而无需更改或清除固定条目列表中的筛选器设置。

## 工具

您可以使用 `编辑` -> `工具` 下的菜单项来切换工具，或勾选菜单 `视图` -> `显示工具箱` 来显示工具箱。

请注意，在任何工具下，右键单击均可以触发 `播放点击位置的音频片段` 功能。

### 光标

用于拖动参数控制器的普通光标工具。

### 剪刀

在单击位置将当前条目分隔成两个条目。
默认情况下，当您使用剪刀单击有效位置时，将会：

1. 播放剪切后的前一个（左边的）条目的音频，方便您确认音素
2. 显示一个对话框来重命名前一个条目 
3. 进行切割和重命名
4. 转到前一个条目

您可以在 `偏好设置` -> `编辑器` -> `剪刀` 中自定义这些行为。

### 平移 

即 `手` 工具。在屏幕上拖动以滚动画布。

## 标注器

标注器（labeler）是 `vLabeler` 的一种配置文件，它定义了所有针对特定语音合成系统的行为。

例如，内建的 `UTAU oto 标注器` 是一个用于编辑 UTAU 的 `oto.ini` 文件的标注器。

一个标注器包含以下定义：

- 语音条目应包含哪些数据/字段（例如，对于 UTAU，一个条目需要 `固定`、`先行发声`、`重叠` 等）
- 数据/字段显示在编辑器中时的外观
- 条目之间是否连续（指任何条目的开始都应等于其前一个条目的结束）
- 如何将标注文件解析为 `vLabeler` 工程
- 如何从 `vLabeler` 工程生成标注文件
- 如何在 `vLabeler` 工程下构建子工程
- 其他编辑特定类型标注文件时的行为

一些标注器还提供了一些可以在 GUI 中更改的设置项目，而无需编辑标注器配置文件本身。
您可以点击 `新建工程` 页面的 `标注器` 选择框右边的 `齿轮` 按钮来打开标注器设置对话框。

如果你想编辑一个 `vLabeler` 暂不支持的语音合成软件的标注文件，您可以自己编写一个标注器配置文件来实现它，而无需等待我们的开发（尽管需要一定的编程知识）。
请查看 [LabelerConf.kt](../src/jvmMain/kotlin/com/sdercolin/vlabeler/model/LabelerConf.kt) 来了解如何开发一个标注器。

您可以在 `设置` -> `标注器...` 中导入自己的标注器。您也可以将自己编写的标注器分发给其他用户，或联系我们将其内置。

## 插件

目前，您可以使用以下两种类型的插件。

### 模板生成器

模板生成器可以通过输入的文件和参数来生成工程模板。

虽然标注器本身支持生成工程模板，但这样生成的模板只是满足了标注器的最低要求，不方便实际使用。
而模板生成器插件则可以创建复杂的模板。 它们通常还支持一些可定制的参数。

您可以在 `新建工程` 页面上选择所有支持所选标注器的模板生成器。

您可以在 `设置` -> `模板生成器...` 中导入/删除/禁用模板生成器。

### 批量编辑插件

批量编辑插件可用于执行复杂的批量编辑任务。

您可以在 `工具` -> `批量编辑` 中找到可用的批量编辑插件。某些显示的插件可能无法点击，这代表它不支持当前使用的标注器。

您可以在 `工具` -> `批量编辑` -> `管理插件...` 中导入/删除/禁用批量编辑插件。

### 插件开发

我们欢迎您为 vLabeler 开发插件。
您可以在任何地方分发您的插件，或者创建一个 Pull Request 来将其内置在 vLabeler 中。

详见 [插件 API 文档](plugin-development.md)。

## 日志

您可以通过 `帮助` -> `打开日志目录` 来查看 vLabeler 的日志，用于开发/调试/测试等目的。

当您向我们报告问题时，请附上最近的日志文件。

## 已知问题

1. 在 Linux 上，文件选择器可能无法选择空文件夹。请在里面创建一些文件，或者将它的路径复制/粘贴到输入框中
2. 有时窗口会意外冻结。您可以通过调整窗口大小来刷新它。
